package PropertyDescriptors
import Func
import Action
import Union
import InspectionInterfaces
import Range

// ============================================================================
public abstract class PropertyDescriptor implements IPropertyDescriptor
  private string m_name
  private string m_category
  private string m_editorType

  // --------------------------------------------------------------------------
  construct(string name, string editorType)
    m_name = name
    m_editorType = editorType

  // --------------------------------------------------------------------------
  override function getName() returns string
    return m_name
  
  // --------------------------------------------------------------------------
  override function getCategory() returns string
    return m_category

  // --------------------------------------------------------------------------
  override function setCategory(string category)
    m_category = category

  // --------------------------------------------------------------------------
  override function getEditorType() returns string
    return m_editorType

  // --------------------------------------------------------------------------
  override function canGetValue(int context, Union value) returns bool
    return true

  // --------------------------------------------------------------------------
  abstract override function getValue(int context, Union value) returns bool

  // --------------------------------------------------------------------------
  override function canSetValue(int context, Union value) returns bool
    return true

  // --------------------------------------------------------------------------
  abstract override function setValue(int context, Union value) returns bool


// ============================================================================
public class StringPropertyDescriptor<T> extends PropertyDescriptor
  private Func1<T, string> m_getter
  private Action2<T, string> m_setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, string> getter)
    super(name, "string")
    m_getter = getter
    m_setter = null

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, string> getter, Action2<T, string> setter)
    super(name, "string")
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, string> getter, Action2<T, string> setter, string editorType)
    super(name, editorType)
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  ondestroy
    if (m_getter != null)
      destroy m_getter
      m_getter = null

    if (m_setter != null)
      destroy m_setter
      m_setter = null

  // --------------------------------------------------------------------------
  override function canGetValue(int context, Union value) returns bool
    return m_getter != null

  // --------------------------------------------------------------------------
  override function getValue(int context, Union value) returns bool
    return value.setString(m_getter.call(context castTo T))

  // --------------------------------------------------------------------------
  override function canSetValue(int context, Union value) returns bool
    return m_setter != null

  // --------------------------------------------------------------------------
  override function setValue(int context, Union value) returns bool
    if (m_setter != null)
      m_setter.call(context castTo T, value.getString())
      return true
    return false

// ============================================================================
public class IntPropertyDescriptor<T> extends PropertyDescriptor
  private Func1<T, int> m_getter
  private Action2<T, int> m_setter
  private rangeInt m_range

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, int> getter)
    super(name, "int")
    m_getter = getter
    m_setter = null

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, int> getter, Action2<T, int> setter)
    super(name, "int")
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, int> getter, Action2<T, int> setter, string editorType)
    super(name, editorType)
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  ondestroy
    if (m_getter != null)
      destroy m_getter
      m_getter = null

    if (m_setter != null)
      destroy m_setter
      m_setter = null

  // --------------------------------------------------------------------------
  override function canGetValue(int context, Union value) returns bool
    return m_getter != null

  // --------------------------------------------------------------------------
  override function getValue(int context, Union value) returns bool
    return value.setInt(m_getter.call(context castTo T))

  // --------------------------------------------------------------------------
  override function canSetValue(int context, Union value) returns bool
    return m_setter != null

  // --------------------------------------------------------------------------
  override function setValue(int context, Union value) returns bool
    if (m_setter != null)
      m_setter.call(context castTo T, value.getInt())
      return true
    return false

  // --------------------------------------------------------------------------
  function getRange() returns rangeInt
    return m_range

  // --------------------------------------------------------------------------
  function setRange(rangeInt range)
    m_range = range

// ============================================================================
public class RealPropertyDescriptor<T> extends PropertyDescriptor
  private Func1<T, real> m_getter
  private Action2<T, real> m_setter
  private rangeReal m_range

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, real> getter)
    super(name, "real")
    m_getter = getter
    m_setter = null

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, real> getter, Action2<T, real> setter)
    super(name, "real")
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, real> getter, Action2<T, real> setter, string editorType)
    super(name, editorType)
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  ondestroy
    if (m_getter != null)
      destroy m_getter
      m_getter = null

    if (m_setter != null)
      destroy m_setter
      m_setter = null

  // --------------------------------------------------------------------------
  override function canGetValue(int context, Union value) returns bool
    return m_getter != null

  // --------------------------------------------------------------------------
  override function getValue(int context, Union value) returns bool
    return value.setReal(m_getter.call(context castTo T))

  // --------------------------------------------------------------------------
  override function canSetValue(int context, Union value) returns bool
    return m_setter != null

  // --------------------------------------------------------------------------
  override function setValue(int context, Union value) returns bool
    if (m_setter != null)
      m_setter.call(context castTo T, value.getReal())
      return true
    return false

  // --------------------------------------------------------------------------
  function getRange() returns rangeReal
    return m_range

  // --------------------------------------------------------------------------
  function setRange(rangeReal range)
    m_range = range

// ============================================================================
public class BoolPropertyDescriptor<T> extends PropertyDescriptor
  private Func1<T, bool> m_getter
  private Action2<T, bool> m_setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, bool> getter)
    super(name, "bool")
    m_getter = getter
    m_setter = null

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, bool> getter, Action2<T, bool> setter)
    super(name, "bool")
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, bool> getter, Action2<T, bool> setter, string editorType)
    super(name, editorType)
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  ondestroy
    if (m_getter != null)
      destroy m_getter
      m_getter = null

    if (m_setter != null)
      destroy m_setter
      m_setter = null

  // --------------------------------------------------------------------------
  override function canGetValue(int context, Union value) returns bool
    return m_getter != null

  // --------------------------------------------------------------------------
  override function getValue(int context, Union value) returns bool
    return value.setBool(m_getter.call(context castTo T))

  // --------------------------------------------------------------------------
  override function canSetValue(int context, Union value) returns bool
    return m_setter != null

  // --------------------------------------------------------------------------
  override function setValue(int context, Union value) returns bool
    if (m_setter != null)
      m_setter.call(context castTo T, value.getBool())
      return true
    return false

// ============================================================================
public class UnitPropertyDescriptor<T> extends PropertyDescriptor
  private Func1<T, unit> m_getter
  private Action2<T, unit> m_setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, unit> getter)
    super(name, "unit")
    m_getter = getter
    m_setter = null

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, unit> getter, Action2<T, unit> setter)
    super(name, "unit")
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  construct(string name, Func1<T, unit> getter, Action2<T, unit> setter, string editorType)
    super(name, editorType)
    m_getter = getter
    m_setter = setter

  // --------------------------------------------------------------------------
  ondestroy
    if (m_getter != null)
      destroy m_getter
      m_getter = null

    if (m_setter != null)
      destroy m_setter
      m_setter = null

  // --------------------------------------------------------------------------
  override function canGetValue(int context, Union value) returns bool
    return m_getter != null

  // --------------------------------------------------------------------------
  override function getValue(int context, Union value) returns bool
    return value.setInt(unitToIndex(m_getter.call(context castTo T)))

  // --------------------------------------------------------------------------
  override function canSetValue(int context, Union value) returns bool
    return m_setter != null

  // --------------------------------------------------------------------------
  override function setValue(int context, Union value) returns bool
    if (m_setter != null)
      m_setter.call(context castTo T, unitFromIndex(value.getInt()))
      return true
    return false